function generateGuid(){var t,r,n;for(t="",n=0;32>n;n++)(8===n||12===n||16===n||20===n)&&(t+="-"),r=Math.floor(16*Math.random()).toString(16).toUpperCase(),t+=r;return t}function postBlast(t,r,n,e,l){return console.log("BLAST FINISHED!"),t?(console.log("blast error",n),l(t,null)):void fs.readFile(e,"utf8",function(t,r){if(t)return console.log("error reading blast output",t),l(t,null);var n=r.substring(r.indexOf("Length"));return console.log("OUTPUT",r),l(null,n)})}function blaster(t,r,n,e,l){var o=e+generateGuid()+".out",s=t+" -query "+n+" -out "+o+" -db "+r+" -outfmt 5";run(s,function(t,r,n){postBlast(t,r,n,o,l)})}function run(t,r){console.log("running",t);var n=require("child_process").exec;n(t,r)}var fs=require("fs"),blast={};blast.makeDB=function(t,r,n,e,l){if(!t)return l(new Error("no type supplied"));if(!r)return l(new Error("no file supplied"));if(!n)return l(new Error("no output path supplied"));var o=r.replace(/^.*[\\\/]/,""),s=o.substr(0,o.lastIndexOf("."));"/"!==n.slice(-1)&&(n+="/");var a=n+s,u="makeblastdb -in "+r+" -dbtype "+t+" -out "+a+" -title "+e;run(u,function(t,r,n){return l(t,r,n,a)})},blast.blastN=function(t,r,n,e){blaster("blastn",t,r,n,e)},blast.blastP=function(t,r,n,e){blaster("blastp",t,r,n,e)},blast.blastX=function(t,r,n,e){blaster("blastx",t,r,n,e)},blast.tblastP=function(t,r,n,e){blaster("tblastp",t,r,n,e)},blast.tblastX=function(t,r,n,e){blaster("tblastx",t,r,n,e)},module.exports=blast;